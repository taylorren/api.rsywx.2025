<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSYWX API 2025 - Complete Wiki</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #fff;
        }
        h1, h2, h3 { color: #2c3e50; }
        h1 { border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        h2 { border-bottom: 2px solid #ecf0f1; padding-bottom: 5px; }
        code { 
            background: #f8f9fa; 
            padding: 2px 4px; 
            border-radius: 3px; 
            font-family: "Monaco", monospace;
        }
        pre { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 5px; 
            overflow-x: auto; 
            border-left: 4px solid #3498db;
        }
        .toc {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .toc ul { margin: 0; }
        .export-info {
            background: #e8f6f3;
            border: 1px solid #16a085;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body><div class="export-info"><strong>ğŸ“š Complete Repository Wiki Export</strong><br>Generated on: 2025-08-23 12:24:25</div><p><h1>RSYWX API 2025 - Complete Repository Wiki</h1></p><p>**Generated on:** 2025-08-23 12:24:25</p><p>---</p><p><h2>Table of Contents</h2></p><p>1. [Project Overview](#project-overview)
2. [Project Structure](#project-structure)
3. [API Documentation](#api-documentation)
4. [Database Information](#database-information)
5. [Dependencies](#dependencies)
6. [Configuration](#configuration)
7. [Testing](#testing)</p><p>---</p><p><h1>Project Overview</h1></p><p><h1>RSYWX API 2025</h1></p><p>A PHP + Slim Framework API for personal library management system.</p><p><h2>Features</h2></p><p>- **Book Collection Status** - Get total books, pages, keywords, and visits
<ul><li>**Book Details** - Retrieve detailed book information by book ID</li>
<li>**Smart Caching** - 24-hour TTL for static data, real-time for dynamic data</li>
<li>**API Key Authentication** - Secure access control</li>
<li>**Apache Integration** - Ready for production deployment</p><p><h2>API Documentation</h2></p><p>Visit the root URL (<code>/</code>) to access the interactive API documentation with detailed endpoint specifications, request/response examples, and data models.</p><p><h2>API Endpoints</h2></p><p><h3>Collection Status</h3></li>
<pre><code>GET /api/v1/books/status</code></pre>
Returns total books, pages, keywords, and visits count.</p><p><h3>Book Details</h3>
<pre><code>GET /api/v1/books/{bookid}</code></pre>
Returns detailed book information including:
<li>Basic book data (title, author, ISBN, etc.)</li>
<li>Publisher and place names</li>
<li>Tags and reviews</li>
<li>Cover image URI</li>
<li>Visit statistics (real-time)</p><p><h3>Authentication</h3></li>
All endpoints (except <code>/health</code> and <code>/</code>) require API key authentication via:
<li>Header: <code>X-API-Key: your-api-key</code></li>
<li>Query parameter: <code>?api_key=your-api-key</code></p><p><h2>Installation</h2></p><p>1. **Clone the repository**</li>
   <pre><code>   git clone https://github.com/taylorren/api.rsywx.2025.git
   cd api.rsywx.2025
   ``<code></p><p>2. **Install dependencies**
   </code>`<code>bash
   composer install
   </code>`<code></p><p>3. **Configure environment**
   </code>`<code>bash
   cp .env.example .env
   # Edit .env with your database credentials and API key
   </code>`<code></p><p>4. **Set up Apache virtual host**
   </code>`<code>bash
   sudo cp apache-vhost.conf /etc/apache2/sites-available/api.conf
   sudo a2ensite api.conf
   sudo a2enmod rewrite headers expires deflate
   sudo systemctl restart apache2
   </code>`<code></p><p>5. **Set cache permissions**
   </code>`<code>bash
   mkdir -p cache
   sudo chown -R www-data:www-data cache/
   </code>`<code></p><p><h2>Configuration</h2></p><p><h3>Environment Variables</h3>
<li></code>DB_HOST<code> - Database host</li>
<li></code>DB_NAME<code> - Database name</li>
<li></code>DB_USER<code> - Database username</li>
<li></code>DB_PASSWORD<code> - Database password</li>
<li></code>API_KEY<code> - Your secure API key</p><p><h3>Database Schema</h3></li>
The API works with the existing RSYWX database schema including:
<li></code>book_book<code> - Main books table</li>
<li></code>book_publisher<code> - Publishers</li>
<li></code>book_place<code> - Storage locations</li>
<li></code>book_taglist<code> - Book tags</li>
<li></code>book_review<code> - Book reviews</li>
<li></code>book_visit<code> - Visit tracking</p><p><h2>Caching</h2></p><p>The API implements intelligent caching:</li>
<li>**Static data** (book details, tags, reviews) cached for 24 hours</li>
<li>**Dynamic data** (visit counts, last visited) always fresh</li>
<li>**Manual refresh** available with </code>?refresh=true<code> parameter</li>
<li>**File-based cache** stored in </code>/cache<code> directory</p><p><h2>Security</h2></p><p>- API key authentication required</li>
<li>CORS headers configured</li>
<li>Security headers (X-Frame-Options, X-Content-Type-Options, etc.)</li>
<li>Input validation and sanitization</li>
<li>Error handling without information disclosure</p><p><h2>Development</h2></p><p><h3>Health Check</h3></code></pre>bash</li>
curl http://your-domain/health
<pre><code>
<h3>Testing Endpoints</h3></code></pre>bash
<h1>Collection status</h1>
curl -H "X-API-Key: your-key" http://your-domain/api/v1/books/status</p><p><h1>Book details</h1>
curl -H "X-API-Key: your-key" http://your-domain/api/v1/books/00666
<pre><code>
<h2>License</h2></p><p>MIT License</p><p><h2>Author</h2></p><p>Taylor Ren - Personal Library Management System</p><p>---</p><p><h1>Project Structure</h1>
</code></pre>
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ .htaccess
â”‚   â”œâ”€â”€ api-docs.css
â”‚   â”œâ”€â”€ api-docs.html
â”‚   â”œâ”€â”€ api-docs.json
â”‚   â”œâ”€â”€ api-docs.yaml
â”‚   â”œâ”€â”€ index.php
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ Cache/
â”‚   â”‚   â”œâ”€â”€ MemoryCache.php
â”‚   â”œâ”€â”€ Controllers/
â”‚   â”‚   â”œâ”€â”€ BookController.php
â”‚   â”‚   â”œâ”€â”€ MiscController.php
â”‚   â”‚   â”œâ”€â”€ ReadingController.php
â”‚   â”‚   â”œâ”€â”€ SystemController.php
â”‚   â”œâ”€â”€ Database/
â”‚   â”‚   â”œâ”€â”€ Connection.php
â”‚   â”œâ”€â”€ Models/
â”‚   â”‚   â”œâ”€â”€ Book.php
â”‚   â”‚   â”œâ”€â”€ BookQueryBuilder.php
â”‚   â”‚   â”œâ”€â”€ BookResponse.php
â”‚   â”‚   â”œâ”€â”€ BookStatus.php
â”‚   â”‚   â”œâ”€â”€ Misc.php
â”‚   â”‚   â”œâ”€â”€ QuoteOfTheDay.php
â”‚   â”‚   â”œâ”€â”€ Reading.php
â”‚   â”‚   â”œâ”€â”€ Weather.php
â”‚   â”‚   â”œâ”€â”€ WordOfTheDay.php
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ Integration/
â”‚   â”‚   â”œâ”€â”€ ApiEndpointsTest.php
â”‚   â”‚   â”œâ”€â”€ BookListEndpointTest.php
â”‚   â”‚   â”œâ”€â”€ TodaysBooksEndpointTest.php
â”‚   â”œâ”€â”€ Unit/
â”‚   â”‚   â”œâ”€â”€ BookStatusTest.php
â”‚   â”œâ”€â”€ BaseTestCase.php
â”‚   â”œâ”€â”€ TEST_SUMMARY.md
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â”œâ”€â”€ API_DOCUMENTATION.md
â”œâ”€â”€ README.md
â”œâ”€â”€ apache-vhost.conf
â”œâ”€â”€ composer.json
â”œâ”€â”€ composer.lock
â”œâ”€â”€ export-wiki-consolidated.php
â”œâ”€â”€ export-wiki.php
â”œâ”€â”€ generate-docs.php
â”œâ”€â”€ phpunit.xml
â”œâ”€â”€ schema.rsywx.sql
<pre><code></p><p>---</p><p><h1>API Documentation</h1></p><p><h1>å›¾ä¹¦ç®¡ç†APIæ–‡æ¡£</h1></p><p><h2>æ¦‚è¿°</h2></p><p>è¿™æ˜¯ä¸€ä¸ªåŸºäºSlim 4æ¡†æ¶æ„å»ºçš„å›¾ä¹¦ç®¡ç†APIåå°ç³»ç»Ÿï¼Œæä¾›å®Œæ•´çš„å›¾ä¹¦CRUDæ“ä½œã€ç¼“å­˜æœºåˆ¶å’Œè®¿é—®ç»Ÿè®¡åŠŸèƒ½ã€‚</p><p><h2>åŸºç¡€ä¿¡æ¯</h2></p><p>- **åŸºç¡€URL**: </code>http://your-domain.com/api/v1<code>
<li>**è®¤è¯æ–¹å¼**: API Key (é€šè¿‡Header </code>X-API-Key<code> æˆ–æŸ¥è¯¢å‚æ•° </code>api_key<code>)</li>
<li>**å“åº”æ ¼å¼**: JSON</li>
<li>**å­—ç¬¦ç¼–ç **: UTF-8</p><p><h2>è®¤è¯</h2></p><p>æ‰€æœ‰APIè¯·æ±‚ï¼ˆé™¤äº†å¥åº·æ£€æŸ¥ï¼‰éƒ½éœ€è¦æä¾›æœ‰æ•ˆçš„API Keyï¼š</p><p><h3>Headeræ–¹å¼</h3></code></pre></li>
X-API-Key: your-api-key-here
<pre><code>
<h3>æŸ¥è¯¢å‚æ•°æ–¹å¼</h3></code></pre>
GET /api/v1/books?api_key=your-api-key-here
<pre><code>
<h2>é€šç”¨å“åº”æ ¼å¼</h2></p><p><h3>æˆåŠŸå“åº”</h3></code></pre>json
{
    "success": true,
    "data": {},
    "cached": false
}
<pre><code>
<h3>é”™è¯¯å“åº”</h3></code></pre>json
{
    "success": false,
    "message": "é”™è¯¯æè¿°"
}
<pre><code>
<h2>APIç«¯ç‚¹</h2></p><p><h3>1. å¥åº·æ£€æŸ¥</h3></p><p>æ£€æŸ¥APIæœåŠ¡çŠ¶æ€ï¼ˆæ— éœ€è®¤è¯ï¼‰ã€‚</p><p>**è¯·æ±‚**</code></pre>
GET /health
<pre><code>
**å“åº”**</code></pre>json
{
    "success": true,
    "message": "API is running",
    "timestamp": "2025-01-20 10:30:00"
}
<pre><code>
<h3>2. è·å–å›¾ä¹¦é›†åˆçŠ¶æ€</h3></p><p>è·å–å›¾ä¹¦åº“çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ€»æ•°ã€é¡µæ•°ã€å­—æ•°å’Œè®¿é—®é‡ã€‚</p><p>**è¯·æ±‚**</code></pre>
GET /api/v1/books/status
<pre><code>
**æŸ¥è¯¢å‚æ•°**
<li></code>refresh<code> (å¯é€‰): </code>true<code> å¼ºåˆ¶åˆ·æ–°ç¼“å­˜</p><p>**å“åº”**</code></pre>json</li>
{
    "success": true,
    "data": {
        "total_books": 2077,
        "total_pages": 425678,
        "total_kwords": 89234,
        "total_visits": 2351070
    },
    "cached": true
}
<pre><code>
<h3>3. è·å–å›¾ä¹¦åˆ—è¡¨</h3></p><p>è·å–å›¾ä¹¦åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µã€è¿‡æ»¤å’Œæ’åºã€‚</p><p>**è¯·æ±‚**</code></pre>
GET /api/v1/books
<pre><code>
**æŸ¥è¯¢å‚æ•°**
<li></code>page<code> (å¯é€‰): é¡µç ï¼Œé»˜è®¤ä¸º1</li>
<li></code>limit<code> (å¯é€‰): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤ä¸º20</li>
<li></code>title<code> (å¯é€‰): æŒ‰æ ‡é¢˜è¿‡æ»¤</li>
<li></code>author<code> (å¯é€‰): æŒ‰ä½œè€…è¿‡æ»¤</li>
<li></code>category<code> (å¯é€‰): æŒ‰åˆ†ç±»è¿‡æ»¤</li>
<li></code>instock<code> (å¯é€‰): æŒ‰åº“å­˜çŠ¶æ€è¿‡æ»¤ (</code>true<code>/</code>false<code>)</li>
<li></code>order_by<code> (å¯é€‰): æ’åºå­—æ®µ (å¦‚: </code>title<code>, </code>author<code>, </code>pubdate<code>)</li>
<li></code>order_dir<code> (å¯é€‰): æ’åºæ–¹å‘ (</code>ASC<code>/</code>DESC<code>)</li>
<li></code>refresh<code> (å¯é€‰): </code>true<code> å¼ºåˆ¶åˆ·æ–°ç¼“å­˜</p><p>**å“åº”**</code></pre>json</li>
{
    "success": true,
    "data": {
        "books": [
            {
                "id": 1,
                "bookid": "B001",
                "title": "ç¤ºä¾‹å›¾ä¹¦",
                "author": "ä½œè€…å§“å",
                "region": "ä¸­å›½",
                "copyrighter": "ç‰ˆæƒæ–¹",
                "translated": false,
                "purchase_date": "2024-01-15",
                "price": "Â¥29.80",
                "publication_date": "2023-12-01",
                "print_date": "2023-12-15",
                "version": "1",
                "decoration": "å¹³è£…",
                "word_count": "25.6ä¸‡å­—",
                "pages": 320,
                "isbn": "978-7-111-12345-6",
                "category": "æŠ€æœ¯",
                "online": "Y",
                "introduction": "å›¾ä¹¦ç®€ä»‹...",
                "in_stock": true,
                "location": "A01",
                "book_age": 1,
                "reviews": [],
                "total_visits": 156,
                "last_visit_time": "2024-01-20 09:30:00",
                "tags": ["ç¼–ç¨‹", "æŠ€æœ¯"]
            }
        ],
        "pagination": {
            "page": 1,
            "limit": 20,
            "total": 20
        }
    },
    "cached": true
}
<pre><code>
<h3>4. æ ¹æ®IDè·å–å•ä¸ªå›¾ä¹¦</h3></p><p>æ ¹æ®æ•°æ®åº“IDè·å–å›¾ä¹¦è¯¦ç»†ä¿¡æ¯ã€‚</p><p>**è¯·æ±‚**</code></pre>
GET /api/v1/books/{id}
<pre><code>
**è·¯å¾„å‚æ•°**
<li></code>id<code>: å›¾ä¹¦çš„æ•°æ®åº“ID</p><p>**æŸ¥è¯¢å‚æ•°**</li>
<li></code>refresh<code> (å¯é€‰): </code>true<code> å¼ºåˆ¶åˆ·æ–°ç¼“å­˜</p><p>**å“åº”**</code></pre>json</li>
{
    "success": true,
    "data": {
        "id": 1,
        "bookid": "B001",
        "title": "ç¤ºä¾‹å›¾ä¹¦",
        // ... å®Œæ•´çš„å›¾ä¹¦ä¿¡æ¯
    },
    "cached": true
}
<pre><code>
<h3>5. æ ¹æ®BookIDè·å–å•ä¸ªå›¾ä¹¦</h3></p><p>æ ¹æ®å›¾ä¹¦ç¼–å·è·å–å›¾ä¹¦è¯¦ç»†ä¿¡æ¯ã€‚</p><p>**è¯·æ±‚**</code></pre>
GET /api/v1/books/bookid/{bookid}
<pre><code>
**è·¯å¾„å‚æ•°**
<li></code>bookid<code>: å›¾ä¹¦ç¼–å·</p><p>**æŸ¥è¯¢å‚æ•°**</li>
<li></code>refresh<code> (å¯é€‰): </code>true<code> å¼ºåˆ¶åˆ·æ–°ç¼“å­˜</p><p>**å“åº”**</code></pre>json</li>
{
    "success": true,
    "data": {
        "id": 1,
        "bookid": "B001",
        "title": "ç¤ºä¾‹å›¾ä¹¦",
        // ... å®Œæ•´çš„å›¾ä¹¦ä¿¡æ¯
    },
    "cached": true
}
<pre><code>
<h3>6. åˆ›å»ºæ–°å›¾ä¹¦</h3></p><p>åˆ›å»ºä¸€æœ¬æ–°å›¾ä¹¦ã€‚</p><p>**è¯·æ±‚**</code></pre>
POST /api/v1/books
Content-Type: application/json</p><p>{
    "bookid": "B002",
    "title": "æ–°å›¾ä¹¦æ ‡é¢˜",
    "author": "ä½œè€…å§“å",
    "region": "ä¸­å›½",
    "translated": false,
    "purchdate": "2024-01-20",
    "price": 35.50,
    "pubdate": "2024-01-01",
    "printdate": "2024-01-10",
    "ver": "1",
    "deco": "å¹³è£…",
    "kword": 280000,
    "page": 350,
    "isbn": "978-7-111-54321-0",
    "category": "æ–‡å­¦",
    "intro": "è¿™æ˜¯ä¸€æœ¬å…³äº...",
    "instock": true,
    "location": "B02"
}
<pre><code>
**å“åº”**</code></pre>json
{
    "success": true,
    "message": "å›¾ä¹¦åˆ›å»ºæˆåŠŸ",
    "data": {
        "id": 2078,
        "bookid": "B002",
        // ... å®Œæ•´çš„å›¾ä¹¦ä¿¡æ¯
    }
}
<pre><code>
<h3>7. æ›´æ–°å›¾ä¹¦</h3></p><p>æ›´æ–°ç°æœ‰å›¾ä¹¦ä¿¡æ¯ã€‚</p><p>**è¯·æ±‚**</code></pre>
PUT /api/v1/books/{id}
Content-Type: application/json</p><p>{
    "title": "æ›´æ–°åçš„æ ‡é¢˜",
    "price": 39.80,
    "instock": false
    // ... å…¶ä»–éœ€è¦æ›´æ–°çš„å­—æ®µ
}
<pre><code>
**å“åº”**</code></pre>json
{
    "success": true,
    "message": "å›¾ä¹¦æ›´æ–°æˆåŠŸ",
    "data": {
        "id": 1,
        "title": "æ›´æ–°åçš„æ ‡é¢˜",
        // ... å®Œæ•´çš„å›¾ä¹¦ä¿¡æ¯
    }
}
<pre><code>
<h3>8. åˆ é™¤å›¾ä¹¦</h3></p><p>åˆ é™¤æŒ‡å®šå›¾ä¹¦ã€‚</p><p>**è¯·æ±‚**</code></pre>
DELETE /api/v1/books/{id}
<pre><code>
**å“åº”**</code></pre>json
{
    "success": true,
    "message": "å›¾ä¹¦åˆ é™¤æˆåŠŸ"
}
<pre><code>
<h2>å›¾ä¹¦å®ä½“å­—æ®µè¯´æ˜</h2></p><p>| å­—æ®µå | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| id | integer | å¦ | æ•°æ®åº“è‡ªå¢ID |
| place | integer | å¦ | è´­ä¹°åœ°ç‚¹ID |
| publisher | integer | å¦ | å‡ºç‰ˆç¤¾ID |
| bookid | string | æ˜¯ | å›¾ä¹¦ç¼–å·ï¼ˆå”¯ä¸€ï¼‰ |
| title | string | æ˜¯ | å›¾ä¹¦æ ‡é¢˜ |
| author | string | æ˜¯ | ä½œè€… |
| region | string | æ˜¯ | åœ°åŒº |
| copyrighter | string | å¦ | ç‰ˆæƒæ–¹ |
| translated | boolean | å¦ | æ˜¯å¦ç¿»è¯‘ä½œå“ |
| purchdate | date | å¦ | è´­ä¹°æ—¥æœŸ |
| price | float | æ˜¯ | ä»·æ ¼ |
| pubdate | date | å¦ | å‡ºç‰ˆæ—¥æœŸ |
| printdate | date | å¦ | å°åˆ·æ—¥æœŸ |
| ver | string | æ˜¯ | ç‰ˆæœ¬ |
| deco | string | æ˜¯ | è£…å¸§æ–¹å¼ |
| kword | integer | æ˜¯ | å­—æ•°ï¼ˆåƒå­—ï¼‰ |
| page | integer | æ˜¯ | é¡µæ•° |
| isbn | string | æ˜¯ | ISBNå·ç  |
| category | string | å¦ | åˆ†ç±» |
| ol | string | å¦ | åœ¨çº¿çŠ¶æ€ |
| intro | string | æ˜¯ | ç®€ä»‹ |
| instock | boolean | æ˜¯ | æ˜¯å¦æœ‰åº“å­˜ |
| location | string | å¦ | å­˜æ”¾ä½ç½® |</p><p><h2>ç¼“å­˜æœºåˆ¶</h2></p><p>ç³»ç»Ÿå®ç°äº†æ™ºèƒ½ç¼“å­˜æœºåˆ¶æ¥ä¼˜åŒ–æ€§èƒ½ï¼š</p><p><h3>ç¼“å­˜ç­–ç•¥</h3>
<li>**åŸºæœ¬å›¾ä¹¦ä¿¡æ¯**: ç¼“å­˜24å°æ—¶ï¼ŒåŒ…æ‹¬å›¾ä¹¦çš„åŸºæœ¬å±æ€§</li>
<li>**å®æ—¶æ•°æ®**: ä¸ç¼“å­˜ï¼ŒåŒ…æ‹¬è¯„è®ºã€è®¿é—®ç»Ÿè®¡ã€æœ€åè®¿é—®æ—¶é—´</li>
<li>**åˆ—è¡¨æŸ¥è¯¢**: ç¼“å­˜24å°æ—¶ï¼ŒæŒ‰æŸ¥è¯¢æ¡ä»¶åˆ†åˆ«ç¼“å­˜</p><p><h3>ç¼“å­˜æ§åˆ¶</h3></li>
<li>ä½¿ç”¨ </code>refresh=true<code> å‚æ•°å¼ºåˆ¶åˆ·æ–°ç¼“å­˜</li>
<li>åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤æ“ä½œä¼šè‡ªåŠ¨æ¸…é™¤ç›¸å…³ç¼“å­˜</li>
<li>å“åº”ä¸­çš„ </code>cached<code> å­—æ®µè¡¨ç¤ºæ•°æ®æ˜¯å¦æ¥è‡ªç¼“å­˜</p><p><h2>è®¿é—®ç»Ÿè®¡</h2></p><p>ç³»ç»Ÿä¼šè‡ªåŠ¨è®°å½•å›¾ä¹¦è®¿é—®æƒ…å†µï¼š</li>
<li>æ¯æ¬¡è·å–å•ä¸ªå›¾ä¹¦è¯¦æƒ…æ—¶ä¼šè®°å½•è®¿é—®</li>
<li>è®°å½•è®¿é—®æ—¶é—´ã€IPåœ°å€ç­‰ä¿¡æ¯</li>
<li>æä¾›æ€»è®¿é—®é‡å’Œæœ€åè®¿é—®æ—¶é—´</p><p><h2>é”™è¯¯ä»£ç </h2></p><p>| HTTPçŠ¶æ€ç  | è¯´æ˜ |</li>
|------------|------|
| 200 | è¯·æ±‚æˆåŠŸ |
| 201 | åˆ›å»ºæˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | è®¤è¯å¤±è´¥ |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |</p><p><h2>ä½¿ç”¨ç¤ºä¾‹</h2></p><p><h3>è·å–å›¾ä¹¦åˆ—è¡¨ï¼ˆå¸¦è¿‡æ»¤ï¼‰</h3></code></pre>bash
curl -H "X-API-Key: your-api-key" \
     "http://your-domain.com/api/v1/books?author=å¼ ä¸‰&category=æŠ€æœ¯&page=1&limit=10"
<pre><code>
<h3>åˆ›å»ºæ–°å›¾ä¹¦</h3></code></pre>bash
curl -X POST \
     -H "X-API-Key: your-api-key" \
     -H "Content-Type: application/json" \
     -d '{
       "bookid": "B003",
       "title": "PHPé«˜çº§ç¼–ç¨‹",
       "author": "æå››",
       "region": "ä¸­å›½",
       "price": 89.00,
       "page": 500,
       "kword": 400,
       "ver": "1",
       "deco": "ç²¾è£…",
       "isbn": "978-7-111-99999-9",
       "intro": "æ·±å…¥å­¦ä¹ PHPé«˜çº§ç‰¹æ€§",
       "instock": true
     }' \
     "http://your-domain.com/api/v1/books"
<pre><code>
<h3>æ›´æ–°å›¾ä¹¦ä¿¡æ¯</h3></code></pre>bash
curl -X PUT \
     -H "X-API-Key: your-api-key" \
     -H "Content-Type: application/json" \
     -d '{"price": 79.00, "instock": false}' \
     "http://your-domain.com/api/v1/books/1"
<pre><code>
<h2>æ³¨æ„äº‹é¡¹</h2></p><p>1. **API Keyå®‰å…¨**: è¯·å¦¥å–„ä¿ç®¡API Keyï¼Œä¸è¦åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­æš´éœ²
2. **æ•°æ®éªŒè¯**: åˆ›å»ºå’Œæ›´æ–°å›¾ä¹¦æ—¶ä¼šè¿›è¡Œæ•°æ®éªŒè¯ï¼Œè¯·ç¡®ä¿æä¾›æœ‰æ•ˆæ•°æ®
3. **ç¼“å­˜åˆ·æ–°**: åœ¨éœ€è¦æœ€æ–°æ•°æ®æ—¶ä½¿ç”¨ </code>refresh=true<code> å‚æ•°
4. **å¹¶å‘è®¿é—®**: ç³»ç»Ÿæ”¯æŒå¹¶å‘è®¿é—®ï¼Œä½†å»ºè®®åˆç†æ§åˆ¶è¯·æ±‚é¢‘ç‡
5. **æ•°æ®å¤‡ä»½**: å»ºè®®å®šæœŸå¤‡ä»½æ•°æ®åº“æ•°æ®</p><p><h2>æŠ€æœ¯æ ˆ</h2></p><p>- **æ¡†æ¶**: Slim 4
<li>**æ•°æ®åº“**: MySQL 8.0</li>
<li>**ç¼“å­˜**: æ–‡ä»¶ç¼“å­˜ç³»ç»Ÿ</li>
<li>**è®¤è¯**: API Key</li>
<li>**æ—¥å¿—**: Monologï¼ˆå¯é€‰ï¼‰</p><p><h2>ç‰ˆæœ¬ä¿¡æ¯</h2></p><p>- **å½“å‰ç‰ˆæœ¬**: v1</li>
<li>**æœ€åæ›´æ–°**: 2025-01-20</li>
<li>**å…¼å®¹æ€§**: PHP 8.0+</p><p>---</p><p><h1>Database Schema Information</h1></p><p><h2>Database Tables</h2></p><p>- </code>book_book<code></li>
<li></code>book_headline<code></li>
<li></code>book_place<code></li>
<li></code>book_publisher<code></li>
<li></code>book_review<code></li>
<li></code>book_taglist<code></li>
<li></code>book_visit<code></li>
<li></code>lakers<code></li>
<li></code>qotd<code></li>
<li></code>wotd<code></li>
<li></code>wpme<code></p><p><h2>Schema File Size</h2></li>
<li>Size: 10,224 bytes</li>
<li>Lines: 243</p><p></li>
---</p><p><h1>Project Dependencies</h1></p><p><h2>Production Dependencies</h2></p><p>- </code>php<code>: >=7.4
<li></code>slim/slim<code>: ^4.0</li>
<li></code>slim/psr7<code>: ^1.0</li>
<li></code>php-di/php-di<code>: ^6.0</li>
<li></code>monolog/monolog<code>: ^2.0</li>
<li></code>vlucas/phpdotenv<code>: ^5.0</li>
<li></code>zircote/swagger-php<code>: ^4.0</p><p><h2>Development Dependencies</h2></p><p>- </code>phpdocumentor/phpdocumentor<code>: ^3.0</li>
<li></code>phpunit/phpunit<code>: ^9.0</p><p></li>
---</p><p><h1>Configuration Files</h1></p><p><h2>Environment Configuration</h2>
</code></pre>bash
<h1>Database Configuration</h1>
DB_HOST=localhost
DB_NAME=rsywx
DB_USER=root
DB_PASSWORD=your_password
DB_CHARSET=utf8mb4</p><p><h1>API Configuration</h1>
API_KEY=your-secret-api-key-here
API_VERSION=v1</p><p><h1>Environment</h1>
APP_ENV=development
LOG_LEVEL=debug</p><p><h1>Rate Limiting</h1>
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=3600
<pre><code>
<h2>Apache Virtual Host</h2>
</code></pre>apache
<VirtualHost *:80>
    ServerName api
    ServerAlias api.yourdomain.com
    DocumentRoot /home/tr/www/api.rsywx.2025/public
    
    <Directory /home/tr/www/api.rsywx.2025/public>
        AllowOverride All
        Require all granted
        
        # Enable URL rewriting for Slim
        RewriteEngine On
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^ index.php [QSA,L]
    </Directory>
    
    # Security headers
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    
    # PHP settings
    php_value upload_max_filesize 10M
    php_value post_max_size 10M
    php_value memory_limit 256M
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/api_error.log
    CustomLog ${APACHE_LOG_DIR}/api_access.log combined
</VirtualHost>
<pre><code>
---</p><p><h1>Testing Information</h1></p><p><h2>PHPUnit Configuration</h2></p><p>Configuration file: </code>phpunit.xml<code></p><p><h2>Test Summary</h2></p><p><h1>API Test Summary</h1></p><p>This document summarizes the comprehensive test coverage for the RSYWX Library API.</p><p><h2>Test Statistics</h2>
<li>**Total Tests**: 44</li>
<li>**Total Assertions**: 559</li>
<li>**Test Files**: 3</li>
<li>**Coverage**: All major endpoints and edge cases</p><p><h2>Test Files</h2></p><p><h3>1. BaseTestCase.php</h3></li>
<li>Provides common test infrastructure</li>
<li>Sets up test environment with proper middleware</li>
<li>Configures all API routes for testing</li>
<li>Handles database connection gracefully</p><p><h3>2. ApiEndpointsTest.php (25 tests, 321 assertions)</h3></li>
Tests all the main API endpoints we've developed:</p><p>#### Core Endpoints
<li>âœ… Health endpoint (</code>/health<code>)</li>
<li>âœ… API key authentication (header and query parameter)</li>
<li>âœ… CORS headers validation</p><p>#### Book Status Endpoint (</code>/books/status<code>)</li>
<li>âœ… Returns collection statistics</li>
<li>âœ… Proper data structure validation</li>
<li>âœ… Cache functionality</p><p>#### Book Detail Endpoint (</code>/books/{bookid}<code>)</li>
<li>âœ… Valid book retrieval</li>
<li>âœ… Invalid book handling (404)</li>
<li>âœ… Proper data structure validation</p><p>#### Latest Books Endpoint (</code>/books/latest[/{count}]<code>)</li>
<li>âœ… Default count (1 book)</li>
<li>âœ… Custom count (3 books)</li>
<li>âœ… Proper data structure validation</p><p>#### Random Books Endpoint (</code>/books/random[/{count}]<code>)</li>
<li>âœ… Default count (1 book)</li>
<li>âœ… Custom count (5 books)</li>
<li>âœ… Maximum count limit (50 books)</li>
<li>âœ… Count validation (caps at 50 even if 100 requested)</li>
<li>âœ… Cache refresh functionality</li>
<li>âœ… API key requirement</li>
<li>âœ… Proper data structure validation</p><p>#### Last Visited Books Endpoint (</code>/books/last_visited[/{count}]<code>)</li>
<li>âœ… Default count (1 book)</li>
<li>âœ… Custom count (5 books)</li>
<li>âœ… Maximum count limit (50 books)</li>
<li>âœ… Chronological ordering validation (most recent first)</li>
<li>âœ… Cache refresh functionality</li>
<li>âœ… API key requirement</li>
<li>âœ… Region information validation</p><p>#### Forgotten Books Endpoint (</code>/books/forgotten[/{count}]<code>)</li>
<li>âœ… Default count (1 book)</li>
<li>âœ… Custom count (5 books)</li>
<li>âœ… Maximum count limit (50 books)</li>
<li>âœ… Chronological ordering validation (oldest visit first)</li>
<li>âœ… Days since visit calculation</li>
<li>âœ… Cache refresh functionality</li>
<li>âœ… API key requirement</p><p><h3>3. TodaysBooksEndpointTest.php (15 tests, 220 assertions)</h3></li>
Comprehensive testing of the "today's books" endpoint:</p><p>#### Basic Functionality
<li>âœ… Default endpoint (</code>/books/today<code>) - returns today's historical books</li>
<li>âœ… Parameterized endpoint (</code>/books/today/{month}/{date}<code>)</li>
<li>âœ… Proper date_info structure validation</li>
<li>âœ… Book data structure validation</p><p>#### Date Validation</li>
<li>âœ… Valid dates (Christmas: 12/25, New Year's: 1/1)</li>
<li>âœ… Leap year support (February 29th)</li>
<li>âœ… Invalid date rejection (February 30th, April 31st)</li>
<li>âœ… Invalid month/day ranges (month 0, 13; day 0, 32)</li>
<li>âœ… Boundary date testing (all month-end dates)</p><p>#### Data Integrity</li>
<li>âœ… Books match requested date (month/day)</li>
<li>âœ… Books are from previous years only</li>
<li>âœ… Years_ago calculation accuracy</li>
<li>âœ… Leap year validation for Feb 29 books</p><p>#### API Features</li>
<li>âœ… Cache functionality and refresh</li>
<li>âœ… API key requirement (header and query)</li>
<li>âœ… Proper error responses (400 for invalid dates)</li>
<li>âœ… CORS headers</p><p>#### Edge Cases</li>
<li>âœ… Leap year date handling (Feb 29)</li>
<li>âœ… Month/day boundary conditions</li>
<li>âœ… Zero values rejection</li>
<li>âœ… Out-of-range values rejection</p><p><h2>Test Coverage Summary</h2></p><p><h3>Endpoints Tested</h3></li>
1. âœ… </code>/health<code> - Health check
2. âœ… </code>/api/v1/books/status<code> - Collection statistics
3. âœ… </code>/api/v1/books/latest[/{count}]<code> - Latest purchased books
4. âœ… </code>/api/v1/books/random[/{count}]<code> - Random books
5. âœ… </code>/api/v1/books/last_visited[/{count}]<code> - Recently visited books
6. âœ… </code>/api/v1/books/forgotten[/{count}]<code> - Forgotten books
7. âœ… </code>/api/v1/books/today<code> - Today's historical books
8. âœ… </code>/api/v1/books/today/{month}/{date}<code> - Specific date historical books
9. âœ… </code>/api/v1/books/{bookid}<code> - Individual book details</p><p><h3>Features Tested</h3>
<li>âœ… Authentication (API key validation)</li>
<li>âœ… CORS headers</li>
<li>âœ… Caching functionality</li>
<li>âœ… Cache refresh mechanism</li>
<li>âœ… Input validation</li>
<li>âœ… Error handling (400, 401, 404, 500)</li>
<li>âœ… Data structure validation</li>
<li>âœ… Date validation and leap year support</li>
<li>âœ… Pagination limits</li>
<li>âœ… Chronological ordering</li>
<li>âœ… Database graceful failure handling</p><p><h3>Data Validation</h3></li>
<li>âœ… Response structure consistency</li>
<li>âœ… Data type validation (integers, strings, booleans)</li>
<li>âœ… Required field presence</li>
<li>âœ… Date format validation</li>
<li>âœ… URL structure validation</li>
<li>âœ… Cache status reporting</p><p><h2>Running Tests</h2></li>
</code></pre>bash
<h1>Run all tests</h1>
php vendor/bin/phpunit tests/ --verbose</p><p><h1>Run specific test file</h1>
php vendor/bin/phpunit tests/Integration/TodaysBooksEndpointTest.php --verbose
php vendor/bin/phpunit tests/Integration/ApiEndpointsTest.php --verbose</p><p><h1>Run with coverage (if xdebug enabled)</h1>
php vendor/bin/phpunit tests/ --coverage-html coverage/
</code>``</p><p><h2>Test Environment</h2>
<li>**PHP Version**: 8.3.6</li>
<li>**PHPUnit Version**: 9.6.23</li>
<li>**Database**: MySQL (with graceful failure handling)</li>
<li>**Environment**: Testing mode with test API key</li>
<li>**Memory Usage**: ~8MB per test run</li>
<li>**Execution Time**: ~10 seconds for full suite</p><p><h2>Notes</h2></li>
<li>Tests include database connection error handling</li>
<li>All tests pass even without database connectivity</li>
<li>Comprehensive edge case coverage</li>
<li>Performance validation included</li>
<li>Security testing (API key requirements)</li>
<li>CORS compliance verification</li></ul>
<h2>Test Files Count</h2></p><p>- Total test files: 4</p><p>
</p></body></html>